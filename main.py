import os
import time
import requests
import warnings
import hashlib
import random
import re
import json
import threading
from datetime import datetime, timedelta
from flask import Flask, request, jsonify, render_template_string
from flask_cors import CORS
from openai import OpenAI

warnings.filterwarnings('ignore')

app = Flask(__name__)
CORS(app)

# Configura√ß√£o OpenAI
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY", "")
OPENAI_MODEL = "gpt-4o-mini"

# Inicializa cliente OpenAI apenas se a chave existir
if OPENAI_API_KEY:
    try:
        client = OpenAI(api_key=OPENAI_API_KEY)
        print("‚úÖ Cliente OpenAI inicializado com sucesso")
    except Exception as e:
        print(f"‚ö†Ô∏è Erro ao inicializar OpenAI: {e}")
        client = None
else:
    client = None
    print("‚ö†Ô∏è OPENAI_API_KEY n√£o configurada - modo fallback ativo")

RENDER_URL = os.getenv("RENDER_URL", "")

# Cache e dados
CACHE_RESPOSTAS = {}
KNOWLEDGE_BASE = {}
HISTORICO_CONVERSAS = []
PING_INTERVAL = 300

# Lock para thread safety
historico_lock = threading.Lock()

# Auto-ping para manter servidor ativo
def auto_ping():
    while True:
        try:
            if RENDER_URL:
                # Garante que a URL tem o protocolo
                url = RENDER_URL if RENDER_URL.startswith('http') else f"https://{RENDER_URL}"
                response = requests.get(f"{url}/health", timeout=10)
                print(f"üèì Auto-ping OK [{response.status_code}]: {datetime.now().strftime('%H:%M:%S')}")
            else:
                # Se RENDER_URL n√£o estiver configurada, pinga localhost
                requests.get("http://localhost:5000/health", timeout=5)
                print(f"üèì Auto-ping local: {datetime.now().strftime('%H:%M:%S')}")
        except Exception as e:
            print(f"‚ùå Erro auto-ping: {e}")
        time.sleep(PING_INTERVAL)

threading.Thread(target=auto_ping, daemon=True).start()

# =============================================================================
# SISTEMA ANTI-ALUCINA√á√ÉO - VALIDA√á√ÉO DE RESPOSTAS
# =============================================================================

# Informa√ß√µes OFICIAIS da NatanDEV (fonte da verdade)
INFORMACOES_OFICIAIS = {
    "criador": "Natan Borges Alves Nascimento",
    "profissao": "Web Developer Full-Stack",
    "localizacao": "Rio de Janeiro, Brasil",
    "atendimento": "Todo o Brasil (remoto)",
    "whatsapp": "(21) 99282-6074",
    "instagram": "@nborges.ofc",
    "email": "borgesnatan09@gmail.com",
    "site": "natansites.com.br",
    "portfolio": "natandev02.netlify.app",
    "github": "github.com/natsongamesoficial551",
    "linkedin": "linkedin.com/in/natan-borges-b3a3b5382/",
    "facebook": "facebook.com/profile.php?id=100076973940954",
    
    "planos": {
        "starter": {
            "mensalidade": "R$ 39,99",
            "desenvolvimento_inicial": "R$ 350,00",
            "descricao": "Site responsivo b√°sico, design moderno, hospedagem inclusa"
        },
        "professional": {
            "mensalidade": "R$ 79,99",
            "desenvolvimento_inicial": "R$ 530,00",
            "ia_opcional": "R$ 115,00/m√™s",
            "descricao": "Design personalizado avan√ßado, SEO, APIs, dom√≠nio personalizado"
        }
    },
    
    "diferenciais": [
        "Desenvolvimento r√°pido (estrutura base em 3-4 horas)",
        "Tecnologia de ponta com IA",
        "Qualidade garantida com revis√£o de c√≥digo",
        "100% responsivo (mobile, tablet, desktop)",
        "Design moderno com anima√ß√µes"
    ],
    
    "tipos_sites": [
        "Sites comerciais (empresas, consult√≥rios, lojas)",
        "Sites interativos (anima√ß√µes, 3D, quizzes)",
        "Sites personalizados (funcionalidades exclusivas)"
    ],
    
    "projetos": [
        {
            "nome": "Espa√ßo Familiares",
            "url": "espacofamiliares.com.br",
            "tipo": "Site para eventos especiais"
        },
        {
            "nome": "DeluxModPack GTAV",
            "url": "deluxgtav.netlify.app",
            "tipo": "Modpack para GTA V (C#)"
        },
        {
            "nome": "Quiz Venezuela",
            "url": "quizvenezuela.onrender.com",
            "tipo": "Quiz educacional interativo"
        },
        {
            "nome": "WebServi√ßo",
            "url": "webservico.netlify.app",
            "tipo": "P√°gina de servi√ßos"
        },
        {
            "nome": "MathWork",
            "url": "mathworkftv.netlify.app",
            "tipo": "Plataforma educacional de matem√°tica"
        },
        {
            "nome": "Alessandra Yoga",
            "url": "alessandrayoga.netlify.app",
            "tipo": "Cart√£o de visita digital"
        }
    ],
    
    "tempo_desenvolvimento": "Estrutura base: 3-4 horas | Projeto completo: 1-2 semanas",
    
    "nao_oferecemos": [
        "Sites prontos/templates b√°sicos",
        "Suporte gratuito ilimitado ap√≥s entrega",
        "Hospedagem gratuita permanente"
    ]
}

# Palavras/frases proibidas (alucina√ß√µes comuns)
PALAVRAS_PROIBIDAS = [
    # Pre√ßos falsos
    "gr√°tis", "gratuito", "sem custo", "de gra√ßa",
    "R$ 0", "0 reais", "free",
    
    # Promessas exageradas
    "garantimos primeiro lugar no Google",
    "100% de convers√£o",
    "sucesso garantido",
    "site pronto em 1 hora",
    
    # Informa√ß√µes falsas
    "atendimento 24/7",
    "suporte ilimitado gratuito",
    "empresa com 10 anos",
    "pr√™mio internacional",
    
    # Servi√ßos n√£o oferecidos
    "criamos aplicativos mobile nativos",
    "fazemos blockchain",
    "desenvolvemos jogos AAA",
    
    # Projetos inventados
    "[nome do cliente]",
    "[outro cliente]",
    "cliente X",
    "empresa Y"
]

# Padr√µes suspeitos que indicam alucina√ß√£o
PADROES_SUSPEITOS = [
    r'R\$\s*0[,.]?00',  # Pre√ßo zero
    r'gr√°t[ui]s',  # Gr√°tis
    r'garantimos?\s+\d+',  # Garantias com n√∫meros
    r'pr√™mio\s+\w+',  # Pr√™mios
    r'\d+\s+anos\s+de\s+experi√™ncia',  # Anos de experi√™ncia falsos
    r'fundado\s+em\s+\d{4}',  # Data de funda√ß√£o
    r'certifica√ß√£o\s+ISO',  # Certifica√ß√µes n√£o comprovadas
]

def validar_resposta_anti_alucinacao(resposta):
    """
    Valida resposta para evitar alucina√ß√µes.
    Retorna (bool_valida, lista_problemas)
    """
    problemas = []
    
    resposta_lower = resposta.lower()
    
    # 1. Verifica palavras proibidas
    for palavra in PALAVRAS_PROIBIDAS:
        if palavra.lower() in resposta_lower:
            problemas.append(f"Palavra proibida: '{palavra}'")
    
    # 2. Verifica padr√µes suspeitos
    for padrao in PADROES_SUSPEITOS:
        if re.search(padrao, resposta_lower):
            match = re.search(padrao, resposta_lower)
            problemas.append(f"Padr√£o suspeito: '{match.group()}'")
    
    # 3. Verifica WhatsApp correto
    if "whatsapp" in resposta_lower or "telefone" in resposta_lower:
        if "21 99282-6074" not in resposta and "99282-6074" not in resposta and "(21) 99282-6074" not in resposta:
            if any(num in resposta for num in ["(11)", "(21) 9", "0800"]):
                problemas.append("N√∫mero de WhatsApp incorreto")
    
    # 4. Verifica pre√ßos corretos
    if "starter" in resposta_lower:
        if "39,99" not in resposta and "39.99" not in resposta:
            problemas.append("Pre√ßo Starter incorreto")
    
    if "professional" in resposta_lower:
        if "79,99" not in resposta and "79.99" not in resposta:
            problemas.append("Pre√ßo Professional incorreto")
    
    # 5. Verifica nome correto
    if "criador" in resposta_lower or "dono" in resposta_lower or "desenvolvedor" in resposta_lower:
        if "natan" not in resposta_lower:
            problemas.append("Nome do criador n√£o mencionado")
    
    valida = len(problemas) == 0
    return valida, problemas

def limpar_alucinacoes(resposta):
    """
    Remove ou corrige alucina√ß√µes detectadas na resposta
    """
    resposta_limpa = resposta
    
    # Remove promessas exageradas
    resposta_limpa = re.sub(r'garantimos?\s+\d+%', '', resposta_limpa)
    
    # Remove men√ß√µes a anos de experi√™ncia n√£o confirmados
    resposta_limpa = re.sub(r'\d+\s+anos\s+de\s+experi√™ncia', 'experi√™ncia comprovada', resposta_limpa)
    
    # Remove certifica√ß√µes n√£o confirmadas
    resposta_limpa = re.sub(r'certifica√ß√£o\s+\w+', '', resposta_limpa)
    
    return resposta_limpa

# =============================================================================
# SISTEMA DE AN√ÅLISE DE INTEN√á√ÉO
# =============================================================================

def analisar_intencao(pergunta):
    """Analisa a inten√ß√£o das perguntas sobre servi√ßos"""
    try:
        p = pergunta.lower().strip()
        
        intencoes = {
            "saudacao": 0,
            "despedida": 0,
            "sobre_natan": 0,
            "sobre_natanai": 0,
            "precos": 0,
            "planos": 0,
            "contato": 0,
            "portfolio": 0,
            "criar_site": 0,
            "tipos_sites": 0,
            "tempo_desenvolvimento": 0,
            "como_funciona": 0,
            "tecnologias": 0,
            "responsivo": 0,
            "seo": 0,
            "diferenciais": 0,
            "projetos_especificos": 0,
            "geral": 0
        }
        
        # PALAVRAS-CHAVE POR CATEGORIA
        
        palavras_saudacao = [
            "oi", "ol√°", "ola", "hey", "bom dia", "boa tarde", "boa noite",
            "tudo bem", "como vai", "e ai"
        ]
        
        palavras_despedida = [
            "tchau", "bye", "at√© logo", "at√© mais", "obrigado", "valeu", "flw"
        ]
        
        palavras_sobre_natan = [
            "quem √© natan", "quem √© o natan", "quem criou", "criador",
            "desenvolvedor", "sobre natan", "sobre voc√™"
        ]
        
        palavras_sobre_natanai = [
            "quem √© voc√™", "o que voc√™ √©", "voc√™ √© uma ia", "natanai"
        ]
        
        palavras_precos = [
            "pre√ßo", "valor", "quanto custa", "custo", "valores",
            "investimento", "or√ßamento"
        ]
        
        palavras_planos = [
            "plano", "pacote", "planos", "starter", "professional",
            "op√ß√µes", "tipos de plano"
        ]
        
        palavras_contato = [
            "contato", "whatsapp", "telefone", "falar", "ligar",
            "instagram", "email", "entrar em contato"
        ]
        
        palavras_portfolio = [
            "portfolio", "projetos", "trabalhos", "cases",
            "exemplos", "j√° fizeram", "feitos"
        ]
        
        palavras_criar_site = [
            "quero criar", "fazer um site", "criar meu site",
            "preciso de um site", "quero um site", "criar site"
        ]
        
        palavras_tipos_sites = [
            "que tipo", "tipos de site", "que sites", "categorias",
            "site comercial", "site interativo"
        ]
        
        palavras_tempo = [
            "quanto tempo", "demora", "prazo", "entrega",
            "r√°pido", "velocidade"
        ]
        
        palavras_como_funciona = [
            "como funciona", "como fa√ßo", "processo", "passo a passo",
            "como contratar", "como come√ßar"
        ]
        
        palavras_tecnologias = [
            "tecnologia", "linguagem", "framework", "usa ia",
            "intelig√™ncia artificial", "ferramentas"
        ]
        
        palavras_responsivo = [
            "responsivo", "mobile", "celular", "tablet",
            "funciona no celular", "adapta"
        ]
        
        palavras_seo = [
            "seo", "google", "busca", "aparecer no google",
            "otimiza√ß√£o", "ranqueamento"
        ]
        
        palavras_diferenciais = [
            "diferencial", "por que escolher", "vantagem",
            "melhor que", "destaque"
        ]
        
        palavras_projetos = [
            "espa√ßo familiares", "mathwork", "quiz venezuela",
            "alessandra yoga", "delux", "webservico"
        ]
        
        # CONTAGEM COM PESOS
        for palavra in palavras_saudacao:
            if palavra in p:
                intencoes["saudacao"] += 5
        
        for palavra in palavras_despedida:
            if palavra in p:
                intencoes["despedida"] += 5
        
        for palavra in palavras_sobre_natan:
            if palavra in p:
                intencoes["sobre_natan"] += 6
        
        for palavra in palavras_sobre_natanai:
            if palavra in p:
                intencoes["sobre_natanai"] += 6
        
        for palavra in palavras_precos:
            if palavra in p:
                intencoes["precos"] += 7
        
        for palavra in palavras_planos:
            if palavra in p:
                intencoes["planos"] += 7
        
        for palavra in palavras_contato:
            if palavra in p:
                intencoes["contato"] += 6
        
        for palavra in palavras_portfolio:
            if palavra in p:
                intencoes["portfolio"] += 6
        
        for palavra in palavras_criar_site:
            if palavra in p:
                intencoes["criar_site"] += 8
        
        for palavra in palavras_tipos_sites:
            if palavra in p:
                intencoes["tipos_sites"] += 5
        
        for palavra in palavras_tempo:
            if palavra in p:
                intencoes["tempo_desenvolvimento"] += 6
        
        for palavra in palavras_como_funciona:
            if palavra in p:
                intencoes["como_funciona"] += 6
        
        for palavra in palavras_tecnologias:
            if palavra in p:
                intencoes["tecnologias"] += 5
        
        for palavra in palavras_responsivo:
            if palavra in p:
                intencoes["responsivo"] += 5
        
        for palavra in palavras_seo:
            if palavra in p:
                intencoes["seo"] += 5
        
        for palavra in palavras_diferenciais:
            if palavra in p:
                intencoes["diferenciais"] += 5
        
        for palavra in palavras_projetos:
            if palavra in p:
                intencoes["projetos_especificos"] += 6
        
        intencao_principal = max(intencoes, key=intencoes.get)
        score_principal = intencoes[intencao_principal]
        
        return intencao_principal if score_principal > 1 else "geral"
    
    except Exception as e:
        print(f"‚ùå Erro an√°lise inten√ß√£o: {e}")
        return "geral"

# =============================================================================
# BASE DE CONHECIMENTO ESPECIALIZADA
# =============================================================================

def carregar_conhecimento_especializado():
    global KNOWLEDGE_BASE
    
    try:
        KNOWLEDGE_BASE = {
            "saudacao": {
                "resposta": """Ol√°! Sou a NatanAI! üöÄ

Assistente virtual inteligente da NatanDEV!

Posso te ajudar com:
‚úÖ Informa√ß√µes sobre sites profissionais
‚úÖ Planos: Starter (R$ 39,99/m√™s) e Professional (R$ 79,99/m√™s)
‚úÖ Portf√≥lio com 6 projetos incr√≠veis
‚úÖ Contato: (21) 99282-6074

Transforme sua presen√ßa digital AGORA!

Em que posso ajudar voc√™?

Vibra√ß√µes Positivas!"""
            },
            
            "despedida": {
                "resposta": "At√© logo! Foi √≥timo conversar! Vibra√ß√µes Positivas! üöÄ"
            },
            
            "sobre_natan": {
                "resposta": """üë®‚Äçüíª Sobre Natan Borges:

**Natan Borges Alves Nascimento**
üöÄ Web Developer Full-Stack
üìç Rio de Janeiro, Brasil
üéØ Especialista em sites profissionais e personalizados

**Destaques:**
‚úÖ 6+ projetos entregues
‚úÖ Desenvolvimento r√°pido (estrutura base em 3-4 horas!)
‚úÖ Tecnologia de ponta com IA
‚úÖ Atendimento em todo o Brasil

**Contatos:**
üìû WhatsApp: (21) 99282-6074
üì∏ Instagram: @nborges.ofc
üåê Site: natansites.com.br
üíº Portf√≥lio: natandev02.netlify.app

Seu site dos sonhos est√° a uma mensagem de dist√¢ncia!

Vibra√ß√µes Positivas!"""
            },
            
            "sobre_natanai": {
                "resposta": """Sou a NatanAI! ü§ñ

Assistente virtual inteligente criada para ajudar com informa√ß√µes sobre os servi√ßos de cria√ß√£o de sites da NatanDEV!

**O que posso fazer:**
‚úÖ Explicar planos e pre√ßos
‚úÖ Mostrar portf√≥lio de projetos
‚úÖ Informar contatos
‚úÖ Esclarecer d√∫vidas sobre desenvolvimento
‚úÖ Ajudar voc√™ a transformar sua presen√ßa digital!

**Meu criador:**
üë®‚Äçüíª Natan Borges Alves Nascimento
üöÄ Web Developer Full-Stack

**Tecnologia:**
Powered by OpenAI GPT-4o-mini com sistema anti-alucina√ß√£o!

Como posso ajudar voc√™ hoje?

Vibra√ß√µes Positivas!"""
            },
            
            "precos": {
                "resposta": """üí∞ Planos e Pre√ßos da NatanDEV:

üå± **PLANO STARTER** - R$ 39,99/m√™s
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
+ R$ 350,00 desenvolvimento inicial (pagamento √∫nico)

Ideal para come√ßar sua presen√ßa online!
‚úÖ Site responsivo b√°sico
‚úÖ Design moderno e limpo
‚úÖ Otimiza√ß√£o para mobile
‚úÖ Hospedagem inclusa
‚úÖ Suporte por WhatsApp/Email

üöÄ **PLANO PROFESSIONAL** - R$ 79,99/m√™s
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
+ R$ 530,00 desenvolvimento inicial (pagamento √∫nico)

Para neg√≥cios que querem CRESCER!
‚úÖ Design personalizado avan√ßado
‚úÖ Anima√ß√µes e interatividade
‚úÖ SEO otimizado (apare√ßa no Google!)
‚úÖ Integra√ß√£o de APIs
‚úÖ Dom√≠nio personalizado
‚úÖ Formul√°rios de contato
‚úÖ Suporte priorit√°rio
‚úÖ IA Inclusa - R$ 115/m√™s (OPCIONAL)

**üí° IMPORTANTE:** Valores de desenvolvimento inicial s√£o pagos UMA VEZ APENAS!
A mensalidade √© s√≥ para hospedagem e manuten√ß√£o cont√≠nua!

Seu neg√≥cio merece brilhar na web!

üìû WhatsApp: (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "planos": {
                "resposta": """üìã Detalhes dos Planos:

üå± **STARTER** (R$ 39,99/m√™s + R$ 350 inicial)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Perfeito para: pequenos neg√≥cios, profissionais aut√¥nomos, cart√µes de visita digitais

Inclui:
‚úÖ Site responsivo b√°sico
‚úÖ Design moderno
‚úÖ Hospedagem
‚úÖ Suporte b√°sico

üöÄ **PROFESSIONAL** (R$ 79,99/m√™s + R$ 530 inicial)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Perfeito para: empresas, e-commerce, projetos complexos

Inclui:
‚úÖ Design personalizado avan√ßado
‚úÖ Anima√ß√µes e interatividade
‚úÖ SEO otimizado
‚úÖ Integra√ß√µes de APIs
‚úÖ Dom√≠nio personalizado
‚úÖ Suporte priorit√°rio
‚úÖ + IA opcional (R$ 115/m√™s)

**Diferencial:** Desenvolvimento R√ÅPIDO (estrutura base em 3-4 horas!)

Qual plano se encaixa melhor para voc√™?

üìû Vamos conversar: (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "contato": {
                "resposta": """üìû Contatos da NatanDEV:

**Natan Borges Alves Nascimento**
üöÄ Web Developer Full-Stack

üì± WhatsApp: **(21) 99282-6074** ‚Üê Chama aqui!
üì∏ Instagram: **@nborges.ofc**
üìß Email: **borgesnatan09@gmail.com**
üåê Site: **natansites.com.br**
üíº Portf√≥lio: **natandev02.netlify.app**

**Redes Sociais:**
üîó GitHub: github.com/natsongamesoficial551
üîó LinkedIn: linkedin.com/in/natan-borges-b3a3b5382/
üîó Facebook: facebook.com/profile.php?id=100076973940954

üìç **Localiza√ß√£o:** Rio de Janeiro, Brasil
üåé **Atendimento:** Todo o Brasil (remoto)

**Resposta r√°pida garantida!**

Manda um "Oi" no WhatsApp e vamos come√ßar seu projeto!

Vibra√ß√µes Positivas!"""
            },
            
            "portfolio": {
                "resposta": """üíº Portf√≥lio NatanDEV - 6 Projetos Incr√≠veis:

01. üè† **Espa√ßo Familiares**
    espacofamiliares.com.br
    Site para eventos especiais (casamentos, festas, dayuse)

02. üéÆ **DeluxModPack GTAV**
    deluxgtav.netlify.app
    Modpack para GTA V desenvolvido em C# (vers√£o BETA)

03. üìù **Quiz Venezuela**
    quizvenezuela.onrender.com
    Quiz educacional interativo

04. üåê **WebServi√ßo**
    webservico.netlify.app
    P√°gina de apresenta√ß√£o de servi√ßos

05. üìö **MathWork**
    mathworkftv.netlify.app
    Plataforma educacional de matem√°tica com 10 alunos

06. üßò **Alessandra Yoga**
    alessandrayoga.netlify.app
    Cart√£o de visita digital profissional

**Veja todos os projetos e certificados:**
üåê natandev02.netlify.app

Sites que convertem visitantes em clientes apaixonados!

Quer um site t√£o incr√≠vel quanto esses?
üìû (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "criar_site": {
                "resposta": """üöÄ Quer criar seu site? Perfeito!

**Processo simples em 4 passos:**

1Ô∏è‚É£ **Contato inicial**
   üìû WhatsApp: (21) 99282-6074
   Me conte sobre seu neg√≥cio e objetivos!

2Ô∏è‚É£ **Escolha do plano**
   üå± Starter: R$ 39,99/m√™s + R$ 350 inicial
   üöÄ Professional: R$ 79,99/m√™s + R$ 530 inicial

3Ô∏è‚É£ **Desenvolvimento**
   ‚ö° Estrutura base: 3-4 horas
   üé® Projeto completo: 1-2 semanas

4Ô∏è‚É£ **Entrega e ajustes**
   ‚úÖ Revis√£o detalhada
   ‚úÖ Corre√ß√µes inclu√≠das
   ‚úÖ Site no ar!

**Diferenciais:**
‚ú® Desenvolvimento r√°pido
‚ú® Tecnologia de ponta com IA
‚ú® 100% responsivo
‚ú® Design moderno

Do zero ao WOW em tempo recorde!

üìû Chama no WhatsApp: (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "tipos_sites": {
                "resposta": """üé® Tipos de Sites que a NatanDEV cria:

üè¢ **Sites Comerciais**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Sites institucionais e corporativos que elevam sua presen√ßa digital!
‚ú® Design moderno
‚ú® Apresenta√ß√£o de servi√ßos
‚ú® Depoimentos de clientes
‚ú® Galeria de produtos
‚ú® Formul√°rios de contato
üìç Perfeito para: empresas, consult√≥rios, escrit√≥rios, lojas

‚ú® **Sites Interativos**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Experi√™ncias digitais envolventes!
‚ú® Anima√ß√µes sofisticadas
‚ú® Elementos 3D
‚ú® Quizzes personalizados
‚ú® Calculadoras interativas
‚ú® Jogos educativos
üìç Ideal para: marcas que querem impressionar, projetos educacionais

üé® **Sites Personalizados**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Projetos exclusivos EXATAMENTE como voc√™ imaginou!
‚ú® Design totalmente customizado
‚ú® Funcionalidades espec√≠ficas
‚ú® Integra√ß√µes com sistemas
‚ú® Pain√©is administrativos
üìç Desde landing pages at√© plataformas complexas!

Criamos experi√™ncias, n√£o apenas sites!

üìû Vamos conversar: (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "tempo_desenvolvimento": {
                "resposta": """‚è±Ô∏è Tempo de Desenvolvimento:

**Velocidade √© nosso diferencial!**

‚ö° **Estrutura Base:** 3-4 horas
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Come√ßamos do zero e rapidamente temos:
‚úÖ Layout funcional
‚úÖ Estrutura responsiva
‚úÖ Design inicial

üé® **Projeto Completo:** 1-2 semanas
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Tempo pode variar conforme complexidade:
‚Ä¢ Sites simples: 1 semana
‚Ä¢ Sites complexos: 2 semanas
‚Ä¢ Projetos especiais: sob consulta

**O que influencia o prazo:**
üìù Quantidade de p√°ginas
üé® Complexidade do design
üîß Funcionalidades espec√≠ficas
üì∏ Fornecimento de conte√∫do

**Diferencial:** Come√ßamos r√°pido e entregamos com qualidade!

Do zero ao WOW em tempo recorde!

üìû Vamos agilizar seu projeto: (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "como_funciona": {
                "resposta": """üìã Como Funciona o Processo:

**Passo a passo completo:**

1Ô∏è‚É£ **Primeiro Contato**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìû WhatsApp: (21) 99282-6074
Conte sobre seu neg√≥cio, objetivos e necessidades

2Ô∏è‚É£ **Planejamento**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä Escolha do plano (Starter ou Professional)
üéØ Defini√ß√£o de funcionalidades
üìù Alinhamento de expectativas

3Ô∏è‚É£ **Desenvolvimento**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚ö° Estrutura base: 3-4 horas
üé® Design e personaliza√ß√£o
üîß Funcionalidades espec√≠ficas
üì± Otimiza√ß√£o responsiva

4Ô∏è‚É£ **Revis√£o**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Testes de qualidade
üêõ Corre√ß√£o de bugs
üìä Valida√ß√£o final

5Ô∏è‚É£ **Entrega**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üöÄ Site no ar!
üìö Suporte inicial
üéì Orienta√ß√µes de uso

**Transpar√™ncia total em cada etapa!**

Pronto para come√ßar?
üìû (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "tecnologias": {
                "resposta": """üíª Tecnologias e Ferramentas:

**Stack Moderno e Profissional:**

üé® **Front-end:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ HTML5, CSS3, JavaScript
‚úÖ Frameworks modernos
‚úÖ Anima√ß√µes suaves
‚úÖ Design responsivo

ü§ñ **Intelig√™ncia Artificial:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Uso estrat√©gico de IA para cria√ß√£o visual
‚úÖ Otimiza√ß√£o de c√≥digo com IA
‚úÖ Assistentes virtuais personalizados (opcional)

‚öôÔ∏è **Back-end:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ APIs modernas
‚úÖ Integra√ß√£o com sistemas
‚úÖ Banco de dados quando necess√°rio

üîç **SEO e Performance:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Otimiza√ß√£o para Google
‚úÖ Performance otimizada
‚úÖ Carregamento r√°pido

üì± **100% Responsivo:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Mobile-first
‚úÖ Funciona em tablets
‚úÖ Desktop otimizado

Tecnologia de ponta ao seu alcance!

üìû (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "responsivo": {
                "resposta": """üì± Sites 100% Responsivos!

**Funciona perfeitamente em TODOS os dispositivos:**

üì± **Mobile (Celular):**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Design adaptado para telas pequenas
‚úÖ Navega√ß√£o otimizada para toque
‚úÖ Carregamento r√°pido
‚úÖ Menu mobile-friendly

üì≤ **Tablet:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Layout intermedi√°rio perfeito
‚úÖ Aproveitamento ideal da tela
‚úÖ Experi√™ncia fluida

üíª **Desktop:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Design completo e expansivo
‚úÖ Todos os recursos dispon√≠veis
‚úÖ Performance otimizada

**Por que √© importante:**
‚Ä¢ 70%+ dos usu√°rios acessam pelo celular
‚Ä¢ Google prioriza sites responsivos
‚Ä¢ Melhor experi√™ncia = mais convers√µes

**Mobile-first:** Pensamos primeiro no celular, depois adaptamos!

Qualidade profissional sem quebrar o banco!

üìû (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "seo": {
                "resposta": """üîç SEO - Apare√ßa no Google!

**Dispon√≠vel no Plano Professional**

üéØ **O que √© SEO:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Otimiza√ß√£o para mecanismos de busca
= Seu site aparece nas pesquisas do Google!

‚úÖ **O que fazemos:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Otimiza√ß√£o de t√≠tulos e descri√ß√µes
‚úÖ URLs amig√°veis
‚úÖ Meta tags corretas
‚úÖ Conte√∫do estruturado
‚úÖ Performance otimizada (Google adora sites r√°pidos!)
‚úÖ Responsividade (obrigat√≥rio para SEO)

üìà **Resultados:**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Maior visibilidade online
‚Ä¢ Mais tr√°fego org√¢nico
‚Ä¢ Clientes encontram voc√™ facilmente
‚Ä¢ Destaque da concorr√™ncia

**Importante:** SEO √© trabalho cont√≠nuo, mas come√ßamos forte!

üöÄ **Plano Professional:** R$ 79,99/m√™s + R$ 530 inicial

Destaque-se da concorr√™ncia com um site IMPEC√ÅVEL!

üìû (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "diferenciais": {
                "resposta": """‚≠ê Diferenciais da NatanDEV:

**Por que escolher a NatanDEV:**

‚ö° **Desenvolvimento R√ÅPIDO**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Estrutura base em apenas 3-4 horas!
Do zero ao WOW em tempo recorde!

ü§ñ **Tecnologia de Ponta com IA**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Uso estrat√©gico de IA para criar visual EXATAMENTE como voc√™ deseja
Expertise humana + poder da IA = qualidade m√°xima!

‚úÖ **Qualidade Garantida**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Revis√£o detalhada do c√≥digo
Corre√ß√£o de erros inclu√≠da
Performance e seguran√ßa impec√°vel

üì± **100% Responsivo**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Funciona perfeitamente em mobile, tablet e desktop!

üé® **Design Moderno**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Layouts profissionais com anima√ß√µes suaves
Gradientes modernos e UX de alto n√≠vel

üí∞ **Pre√ßo Justo**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Qualidade profissional sem quebrar o banco!
Planos acess√≠veis para todos

ü§ù **Atendimento Personalizado**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Suporte direto com o desenvolvedor
WhatsApp, Instagram, Email

Sites que convertem visitantes em clientes apaixonados!

üìû (21) 99282-6074

Vibra√ß√µes Positivas!"""
            },
            
            "projetos_especificos": {
                "resposta": """üíº Projetos em Destaque:

**Conhe√ßa os cases de sucesso:**

üè† **Espa√ßo Familiares**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üåê espacofamiliares.com.br
Site completo para eventos especiais
Design elegante, responsivo e moderno

üìö **MathWork**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üåê mathworkftv.netlify.app
Plataforma educacional de matem√°tica
10 alunos, v√≠deos explicativos, interface did√°tica

üßò **Alessandra Yoga**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üåê alessandrayoga.netlify.app
Cart√£o de visita digital profissional
Design minimalista e elegante

üéÆ **DeluxModPack GTAV**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üåê deluxgtav.netlify.app
Modpack para GTA V (desenvolvido em C#)
Vers√£o BETA com recursos avan√ßados

üìù **Quiz Venezuela**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üåê quizvenezuela.onrender.com
Quiz educacional interativo
Um dos primeiros projetos!

üåê **WebServi√ßo**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üåê webservico.netlify.app
P√°gina de apresenta√ß√£o de servi√ßos

**Veja TODOS os projetos e certificados:**
üíº natandev02.netlify.app

Quer um site t√£o incr√≠vel quanto esses?
üìû (21) 99282-6074

Vibra√ß√µes Positivas!"""
            }
        }
        
        print(f"‚úÖ Base carregada: {len(KNOWLEDGE_BASE)} categorias")
        
    except Exception as e:
        print(f"‚ùå Erro ao carregar base: {e}")
        KNOWLEDGE_BASE = {}

# =============================================================================
# BUSCA NA BASE ESPECIALIZADA
# =============================================================================

def buscar_resposta_especializada(pergunta):
    """Busca resposta na base de conhecimento especializada"""
    try:
        intencao = analisar_intencao(pergunta)
        
        if intencao in KNOWLEDGE_BASE:
            resposta = KNOWLEDGE_BASE[intencao]["resposta"]
            print(f"‚úÖ Resposta base especializada: {intencao}")
            return resposta, intencao
        
        return None, intencao
        
    except Exception as e:
        print(f"‚ùå Erro busca especializada: {e}")
        return None, "geral"

# =============================================================================
# PROCESSAMENTO H√çBRIDO COM OPENAI + ANTI-ALUCINA√á√ÉO
# =============================================================================

def verificar_openai():
    """Verifica se OpenAI est√° dispon√≠vel"""
    try:
        if not OPENAI_API_KEY or len(OPENAI_API_KEY) < 20:
            return False
        
        if client is None:  # NOVA VERIFICA√á√ÉO
            return False
        
        response = client.chat.completions.create(
            model=OPENAI_MODEL,
            messages=[{"role": "user", "content": "teste"}],
            max_tokens=5
        )
        return True
    except Exception as e:
        print(f"‚ùå OpenAI indispon√≠vel: {e}")
        return False

def processar_openai_hibrido(pergunta, intencao):
    """
    Processa com OpenAI em modo H√çBRIDO com anti-alucina√ß√£o
    """
    # NOVA VERIFICA√á√ÉO ‚úÖ
    if client is None:
        return None
    
    if not verificar_openai():
        return None
    
    try:
        # Monta prompt RESTRITIVO com informa√ß√µes oficiais
        prompt_sistema = f"""Voc√™ √© NatanAI, assistente virtual inteligente da NatanDEV!

INFORMA√á√ïES OFICIAIS (use quando relevante):

**CRIADOR:**
Nome: Natan Borges Alves Nascimento
Profiss√£o: Web Developer Full-Stack
Localiza√ß√£o: Rio de Janeiro, Brasil

**CONTATOS:**
WhatsApp: (21) 99282-6074
Instagram: @nborges.ofc
Email: borgesnatan09@gmail.com
Site: natansites.com.br
Portf√≥lio: natandev02.netlify.app

**PLANOS:**
Starter: R$ 39,99/m√™s + R$ 350,00 inicial (pagamento √∫nico)
Professional: R$ 79,99/m√™s + R$ 530,00 inicial (pagamento √∫nico)
IA opcional no Professional: +R$ 115,00/m√™s

**PROJETOS:**
1. Espa√ßo Familiares (espacofamiliares.com.br)
2. MathWork (mathworkftv.netlify.app)
3. Alessandra Yoga (alessandrayoga.netlify.app)
4. DeluxModPack GTAV (deluxgtav.netlify.app)
5. Quiz Venezuela (quizvenezuela.onrender.com)
6. WebServi√ßo (webservico.netlify.app)

**DIFERENCIAIS:**
- Desenvolvimento r√°pido (estrutura base em 3-4 horas)
- Tecnologia de ponta com IA
- 100% responsivo
- Design moderno

**TEMPO DESENVOLVIMENTO:**
Estrutura base: 3-4 horas
Projeto completo: 1-2 semanas

REGRAS CR√çTICAS:
1. NUNCA invente informa√ß√µes sobre servi√ßos
2. NUNCA mencione pre√ßos diferentes dos oficiais
3. NUNCA diga que oferecemos servi√ßos n√£o listados
4. NUNCA invente projetos ou clientes
5. Use APENAS as informa√ß√µes oficiais acima
6. Se n√£o souber, direcione para contato: (21) 99282-6074

PARA OUTRAS PERGUNTAS N√ÉO RELACIONADAS AOS SERVI√áOS:
- Responda de forma √∫til e educada
- Seja simples e direta
- Depois, mencione brevemente que sua especialidade √© sobre servi√ßos de sites

PERSONALIDADE:
- Entusiasta e empolgante
- Use frases impactantes ocasionalmente
- Termine 30% das respostas com "Vibra√ß√µes Positivas!"
- M√°ximo 200 palavras
- Use 2-4 emojis no m√°ximo

FOCO ATUAL: {intencao.upper() if intencao != 'geral' else 'Responda de forma √∫til'}
"""

        prompt_usuario = f"Responda de forma direta e empolgante: {pergunta}"

        # Chamada OpenAI
        response = client.chat.completions.create(
            model=OPENAI_MODEL,
            messages=[
                {"role": "system", "content": prompt_sistema},
                {"role": "user", "content": prompt_usuario}
            ],
            max_tokens=300,
            temperature=0.4,
            top_p=0.85,
            presence_penalty=0.1,
            frequency_penalty=0.1
        )
        
        resposta_openai = response.choices[0].message.content.strip()
        
        # VALIDA√á√ÉO ANTI-ALUCINA√á√ÉO
        valida, problemas = validar_resposta_anti_alucinacao(resposta_openai)
        
        if not valida:
            print(f"‚ö†Ô∏è Alucina√ß√£o detectada! Problemas: {problemas}")
            resposta_openai = limpar_alucinacoes(resposta_openai)
            
            valida2, problemas2 = validar_resposta_anti_alucinacao(resposta_openai)
            if len(problemas2) > 2:
                print(f"‚ùå Resposta OpenAI descartada por m√∫ltiplas alucina√ß√µes")
                return None
        
        # Garante que tem "Vibra√ß√µes Positivas!" em algumas respostas
        import random
        if random.random() < 0.3 and "vibra√ß√µes positivas" not in resposta_openai.lower():
            resposta_openai += "\n\nVibra√ß√µes Positivas!"
        
        print(f"‚úÖ Resposta OpenAI h√≠brida validada")
        return resposta_openai
        
    except Exception as e:
        print(f"‚ùå Erro OpenAI h√≠brido: {e}")
        return None

# =============================================================================
# GERADOR PRINCIPAL H√çBRIDO
# =============================================================================

def gerar_resposta_hibrida_otimizada(pergunta):
    """
    Sistema H√çBRIDO:
    1. Tenta base especializada (100% confi√°vel)
    2. Se n√£o encontrar, usa OpenAI com valida√ß√£o anti-alucina√ß√£o
    3. Se falhar, usa fallback confi√°vel
    """
    try:
        # Cache
        pergunta_hash = hashlib.md5(pergunta.lower().strip().encode()).hexdigest()
        if pergunta_hash in CACHE_RESPOSTAS:
            return CACHE_RESPOSTAS[pergunta_hash], "cache"
        
        # 1. PRIORIDADE: Base especializada (0% alucina√ß√£o)
        resposta_base, intencao = buscar_resposta_especializada(pergunta)
        if resposta_base:
            CACHE_RESPOSTAS[pergunta_hash] = resposta_base
            return resposta_base, f"base_especializada_{intencao}"
        
        # 2. BACKUP: OpenAI com valida√ß√£o anti-alucina√ß√£o
        resposta_openai = processar_openai_hibrido(pergunta, intencao)
        if resposta_openai:
            CACHE_RESPOSTAS[pergunta_hash] = resposta_openai
            return resposta_openai, f"openai_hibrido_{intencao}"
        
        # 3. FALLBACK: Resposta confi√°vel da base
        fallbacks_confiaveis = {
            "precos": "üí∞ Planos:\n\nüå± Starter: R$ 39,99/m√™s + R$ 350 inicial\nüöÄ Professional: R$ 79,99/m√™s + R$ 530 inicial\n\nüìû (21) 99282-6074\n\nVibra√ß√µes Positivas!",
            "contato": "üìû Contatos:\n\nWhatsApp: (21) 99282-6074\nInstagram: @nborges.ofc\nSite: natansites.com.br\nPortf√≥lio: natandev02.netlify.app\n\nVibra√ß√µes Positivas!",
            "portfolio": "üíº Portf√≥lio com 6 projetos:\n\n‚Ä¢ Espa√ßo Familiares\n‚Ä¢ MathWork\n‚Ä¢ Alessandra Yoga\n‚Ä¢ DeluxModPack GTAV\n‚Ä¢ Quiz Venezuela\n‚Ä¢ WebServi√ßo\n\nVeja todos: natandev02.netlify.app\n\nüìû (21) 99282-6074",
            "criar_site": "üöÄ Vamos criar seu site!\n\nChame no WhatsApp: (21) 99282-6074\n\nPlanos a partir de R$ 39,99/m√™s!\n\nVibra√ß√µes Positivas!",
            "sobre_natan": "üë®‚Äçüíª Natan Borges Alves Nascimento\nWeb Developer Full-Stack do Rio de Janeiro\n\nVeja projetos: natandev02.netlify.app\nüìû (21) 99282-6074",
            "geral": "Sou a NatanAI! üöÄ\n\nCrio sites profissionais e modernos!\n\nPlanos: R$ 39,99/m√™s ou R$ 79,99/m√™s\nüìû (21) 99282-6074\n\nVibra√ß√µes Positivas!"
        }
        
        resposta_fallback = fallbacks_confiaveis.get(intencao, fallbacks_confiaveis["geral"])
        CACHE_RESPOSTAS[pergunta_hash] = resposta_fallback
        return resposta_fallback, f"fallback_{intencao}"
        
    except Exception as e:
        print(f"‚ùå Erro geral: {e}")
        return "Para informa√ß√µes, fale com Natan: (21) 99282-6074\n\nVibra√ß√µes Positivas!", "erro_emergency"

# =============================================================================
# ROTAS DA API
# =============================================================================

@app.route('/health', methods=['GET'])
@app.route('/api/health', methods=['GET'])
def health():
    try:
        return jsonify({
            "status": "online",
            "sistema": "NatanAI v4.0 H√çBRIDA",
            "modo": "OpenAI GPT-4o-mini + Base Especializada + Anti-Alucina√ß√£o",
            "modelo": OPENAI_MODEL,
            "openai_ativo": verificar_openai(),
            "cache_size": len(CACHE_RESPOSTAS),
            "base_conhecimento": len(KNOWLEDGE_BASE),
            "info_servicos": {
                "criador": INFORMACOES_OFICIAIS["criador"],
                "whatsapp": INFORMACOES_OFICIAIS["whatsapp"],
                "site": INFORMACOES_OFICIAIS["site"],
                "portfolio": INFORMACOES_OFICIAIS["portfolio"],
                "projetos_total": len(INFORMACOES_OFICIAIS["projetos"])
            },
            "sistema_anti_alucinacao": {
                "validacao_ativa": True,
                "palavras_proibidas": len(PALAVRAS_PROIBIDAS),
                "padroes_suspeitos": len(PADROES_SUSPEITOS),
                "limpeza_automatica": True
            },
            "funcionalidades": [
                "Base especializada 100% confi√°vel",
                "OpenAI com valida√ß√£o anti-alucina√ß√£o",
                "Detec√ß√£o de informa√ß√µes inventadas",
                "Limpeza autom√°tica de alucina√ß√µes",
                "Fallback sempre confi√°vel",
                "Cache inteligente"
            ]
        })
    except Exception as e:
        return jsonify({"error": str(e)}), 500

@app.route('/chat', methods=['POST'])
@app.route('/api/chat', methods=['POST'])
def chat_hibrido():
    global HISTORICO_CONVERSAS
    
    try:
        data = request.get_json()
        
        if not data or 'message' not in data and 'pergunta' not in data:
            return jsonify({"error": "Mensagem n√£o fornecida"}), 400
        
        pergunta = data.get('message') or data.get('pergunta', '')
        pergunta = pergunta.strip()
        
        if not pergunta:
            return jsonify({"error": "Mensagem vazia"}), 400
        
        print(f"\nüí¨ [{datetime.now().strftime('%H:%M:%S')}] Pergunta: {pergunta}")
        
        # Gera resposta H√çBRIDA
        resposta, fonte = gerar_resposta_hibrida_otimizada(pergunta)
        
        # Valida√ß√£o final anti-alucina√ß√£o
        valida, problemas = validar_resposta_anti_alucinacao(resposta)
        if not valida:
            print(f"‚ö†Ô∏è Valida√ß√£o final: {len(problemas)} problemas detectados")
        
        # Hist√≥rico
        with historico_lock:
            HISTORICO_CONVERSAS.append({
                "timestamp": datetime.now().isoformat(),
                "pergunta": pergunta,
                "fonte": fonte,
                "validacao_ok": valida,
                "problemas": len(problemas) if not valida else 0
            })
            
            if len(HISTORICO_CONVERSAS) > 1000:
                HISTORICO_CONVERSAS = HISTORICO_CONVERSAS[-500:]
        
        return jsonify({
            "response": resposta,
            "resposta": resposta,  # Compatibilidade
            "metadata": {
                "fonte": fonte,
                "sistema": "NatanAI v4.0 H√≠brida",
                "modelo": OPENAI_MODEL if "openai" in fonte else "Base Especializada",
                "validacao_anti_alucinacao": valida,
                "modo_hibrido": True,
                "confiabilidade": "alta" if valida else "media"
            }
        })
        
    except Exception as e:
        print(f"‚ùå Erro no chat: {e}")
        return jsonify({
            "response": "Para informa√ß√µes, fale com Natan: (21) 99282-6074\n\nVibra√ß√µes Positivas!",
            "resposta": "Para informa√ß√µes, fale com Natan: (21) 99282-6074\n\nVibra√ß√µes Positivas!",
            "metadata": {
                "fonte": "erro_emergency",
                "error": str(e)
            }
        }), 500

@app.route('/api/info', methods=['GET'])
def info():
    """Retorna informa√ß√µes sobre a NatanAI"""
    return jsonify({
        "nome": "NatanAI",
        "versao": "4.0 - H√≠brida (OpenAI + Base Especializada)",
        "criador": INFORMACOES_OFICIAIS["criador"],
        "profissao": INFORMACOES_OFICIAIS["profissao"],
        "modelo": {
            "nome": OPENAI_MODEL,
            "tipo": "OpenAI GPT-4o-mini",
            "status": "üü¢ Online" if verificar_openai() else "üî¥ Offline",
            "modo": "H√≠brido com anti-alucina√ß√£o"
        },
        "contato": {
            "whatsapp": INFORMACOES_OFICIAIS["whatsapp"],
            "instagram": INFORMACOES_OFICIAIS["instagram"],
            "email": INFORMACOES_OFICIAIS["email"],
            "site": INFORMACOES_OFICIAIS["site"],
            "portfolio": INFORMACOES_OFICIAIS["portfolio"]
        },
        "planos": INFORMACOES_OFICIAIS["planos"],
        "projetos": INFORMACOES_OFICIAIS["projetos"],
        "localizacao": INFORMACOES_OFICIAIS["localizacao"],
        "atendimento": INFORMACOES_OFICIAIS["atendimento"]
    })

@app.route('/estatisticas', methods=['GET'])
@app.route('/api/estatisticas', methods=['GET'])
def estatisticas():
    try:
        if not HISTORICO_CONVERSAS:
            return jsonify({"message": "Nenhuma conversa registrada"})
        
        fontes_count = {}
        validacoes_ok = 0
        total_problemas = 0
        
        with historico_lock:
            for conv in HISTORICO_CONVERSAS:
                fonte = conv.get("fonte", "unknown")
                fontes_count[fonte] = fontes_count.get(fonte, 0) + 1
                
                if conv.get("validacao_ok", True):
                    validacoes_ok += 1
                total_problemas += conv.get("problemas", 0)
        
        return jsonify({
            "total_conversas": len(HISTORICO_CONVERSAS),
            "distribuicao_fontes": fontes_count,
            "validacao_anti_alucinacao": {
                "respostas_validadas": validacoes_ok,
                "taxa_sucesso": round((validacoes_ok / len(HISTORICO_CONVERSAS)) * 100, 2),
                "total_problemas_detectados": total_problemas,
                "media_problemas": round(total_problemas / len(HISTORICO_CONVERSAS), 2)
            },
            "sistema": "NatanAI v4.0 H√≠brida",
            "modo": "OpenAI + Base Especializada + Anti-Alucina√ß√£o"
        })
        
    except Exception as e:
        return jsonify({"error": str(e)}), 500

@app.route('/api/exemplos', methods=['GET'])
def exemplos():
    """Retorna exemplos de perguntas"""
    return jsonify({
        "exemplos_perguntas": [
            "Quanto custa um site?",
            "Quem √© o Natan?",
            "Quero criar um site para minha empresa",
            "Quanto tempo demora para fazer um site?",
            "O site fica responsivo?",
            "Voc√™s usam IA?",
            "Quais projetos j√° fizeram?",
            "Como entro em contato?",
            "Qual o WhatsApp?",
            "Quero ver o portf√≥lio",
            "Me fale sobre os planos",
            "Qual a diferen√ßa entre Starter e Professional?",
            "Como funciona o processo?",
            "Faz site com SEO?",
            "Atende em qual cidade?"
        ],
        "dica": "A NatanAI conhece TUDO sobre os servi√ßos da NatanDEV! Pergunte qualquer coisa! üöÄ",
        "modelo": f"Usando OpenAI {OPENAI_MODEL} com sistema anti-alucina√ß√£o"
    })

@app.route('/ping', methods=['GET'])
def ping():
    return jsonify({
        "status": "pong",
        "timestamp": datetime.now().isoformat(),
        "sistema": "NatanAI v4.0 H√≠brida"
    })

@app.route('/', methods=['GET'])
def home():
    html = """
    <!DOCTYPE html>
    <html>
    <head>
        <title>NatanAI v4.0 - H√≠brida</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { 
                font-family: 'Segoe UI', Arial, sans-serif; 
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
            }
            .container { 
                max-width: 850px; 
                margin: 0 auto; 
                background: white; 
                padding: 30px; 
                border-radius: 20px; 
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            }
            .header { 
                text-align: center; 
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 3px solid #667eea;
            }
            .header h1 { 
                color: #667eea; 
                margin-bottom: 10px;
                font-size: 2em;
            }
            .badge {
                display: inline-block;
                padding: 8px 16px;
                margin: 5px;
                border-radius: 20px;
                font-size: 0.85em;
                font-weight: bold;
            }
            .badge-hybrid { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
            .badge-ai { background: #4CAF50; color: white; }
            .badge-safe { background: #2196F3; color: white; }
            
            .info-box {
                background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
                padding: 20px;
                border-radius: 15px;
                margin: 20px 0;
                border-left: 5px solid #667eea;
            }
            .info-box h3 { color: #667eea; margin-bottom: 10px; }
            .info-box ul { list-style: none; padding-left: 0; }
            .info-box li { 
                padding: 8px 0; 
                padding-left: 25px;
                position: relative;
            }
            .info-box li:before {
                content: "‚úì";
                position: absolute;
                left: 0;
                color: #4CAF50;
                font-weight: bold;
            }
            
            .chat-box { 
                border: 2px solid #e0e0e0;
                height: 450px; 
                overflow-y: auto; 
                padding: 20px; 
                margin: 20px 0; 
                background: #fafafa;
                border-radius: 15px;
            }
            .message { 
                margin: 15px 0; 
                padding: 15px; 
                border-radius: 15px;
                animation: fadeIn 0.3s;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .user { 
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                margin-left: 20%;
                border-bottom-right-radius: 5px;
            }
            .bot { 
                background: #e8f5e9;
                margin-right: 20%;
                border-bottom-left-radius: 5px;
                border-left: 4px solid #4CAF50;
            }
            .bot-hybrid {
                background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
                border-left: 4px solid #667eea;
            }
            .metadata {
                font-size: 0.75em;
                color: #666;
                margin-top: 8px;
                padding-top: 8px;
                border-top: 1px solid rgba(0,0,0,0.1);
            }
            .metadata-badge {
                display: inline-block;
                padding: 3px 8px;
                margin: 2px;
                background: rgba(0,0,0,0.1);
                border-radius: 10px;
                font-size: 0.9em;
            }
            
            .input-area { 
                display: flex; 
                gap: 10px;
                margin-top: 20px;
            }
            input { 
                flex: 1; 
                padding: 15px; 
                border: 2px solid #e0e0e0;
                border-radius: 25px;
                font-size: 1em;
                transition: all 0.3s;
            }
            input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }
            button { 
                padding: 15px 30px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white; 
                border: none;
                border-radius: 25px;
                cursor: pointer;
                font-weight: bold;
                transition: all 0.3s;
            }
            button:hover { 
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            }
            button:active {
                transform: translateY(0);
            }
            
            .examples {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin: 20px 0;
            }
            .example-btn {
                padding: 8px 16px;
                background: white;
                border: 2px solid #667eea;
                color: #667eea;
                border-radius: 20px;
                cursor: pointer;
                font-size: 0.9em;
                transition: all 0.3s;
            }
            .example-btn:hover {
                background: #667eea;
                color: white;
            }
            
            .footer {
                text-align: center;
                margin-top: 30px;
                padding-top: 20px;
                border-top: 2px solid #e0e0e0;
                color: #666;
                font-size: 0.9em;
            }
            
            @media (max-width: 600px) {
                .container { padding: 15px; }
                .header h1 { font-size: 1.5em; }
                .message { margin: 10px 0; padding: 10px; }
                .user, .bot { margin-left: 0; margin-right: 0; }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ü§ñ NatanAI v4.0 - H√çBRIDA</h1>
                <p style="color: #666; margin: 10px 0;">Assistente Inteligente da NatanDEV</p>
                <div>
                    <span class="badge badge-hybrid">MODO H√çBRIDO</span>
                    <span class="badge badge-ai">OpenAI GPT-4o-mini</span>
                    <span class="badge badge-safe">Anti-Alucina√ß√£o</span>
                </div>
            </div>
            
            <div class="info-box">
                <h3>üéØ Sistema H√≠brido Inteligente</h3>
                <ul>
                    <li><strong>Base Especializada:</strong> Respostas 100% confi√°veis sobre servi√ßos</li>
                    <li><strong>OpenAI GPT-4o-mini:</strong> Intelig√™ncia avan√ßada para perguntas complexas</li>
                    <li><strong>Valida√ß√£o Anti-Alucina√ß√£o:</strong> Verifica e corrige informa√ß√µes inventadas</li>
                    <li><strong>Fallback Inteligente:</strong> Sempre direciona para Natan quando necess√°rio</li>
                </ul>
            </div>
            
            <div class="info-box">
                <h3>üìç Sobre a NatanDEV</h3>
                <ul>
                    <li><strong>Criador:</strong> Natan Borges Alves Nascimento - Web Developer Full-Stack</li>
                    <li><strong>WhatsApp:</strong> (21) 99282-6074</li>
                    <li><strong>Planos:</strong> Starter (R$ 39,99/m√™s) | Professional (R$ 79,99/m√™s)</li>
                    <li><strong>Projetos:</strong> 6+ sites entregues (Espa√ßo Familiares, MathWork, etc.)</li>
                    <li><strong>Portf√≥lio:</strong> natandev02.netlify.app</li>
                    <li><strong>Diferencial:</strong> Estrutura base em 3-4 horas!</li>
                </ul>
            </div>
            
            <div id="chat-box" class="chat-box">
                <div class="message bot bot-hybrid">
                    <strong>ü§ñ NatanAI v4.0 H√≠brida:</strong><br><br>
                    Ol√°! Sou a NatanAI em vers√£o h√≠brida! üöÄ<br><br>
                    
                    <strong>Como funciono:</strong><br>
                    ‚úÖ Uso base especializada para respostas r√°pidas e confi√°veis<br>
                    ‚úÖ Uso OpenAI GPT-4o-mini para perguntas mais complexas<br>
                    ‚úÖ Valido todas as respostas para evitar informa√ß√µes incorretas<br>
                    ‚úÖ Se n√£o souber, direciono para Natan!<br><br>
                    
                    <strong>Pergunte sobre:</strong> pre√ßos, planos, portf√≥lio, tempo de desenvolvimento, contatos!<br><br>
                    
                    <strong>Vibra√ß√µes Positivas!</strong> üíö
                </div>
            </div>
            
            <div class="examples">
                <button class="example-btn" onclick="testar('Quanto custa um site?')">üí∞ Pre√ßos</button>
                <button class="example-btn" onclick="testar('Quero criar um site')">üöÄ Criar Site</button>
                <button class="example-btn" onclick="testar('Qual o portf√≥lio?')">üíº Portf√≥lio</button>
                <button class="example-btn" onclick="testar('Quanto tempo demora?')">‚è±Ô∏è Prazo</button>
                <button class="example-btn" onclick="testar('Como entro em contato?')">üìû Contato</button>
                <button class="example-btn" onclick="testar('Quem √© o Natan?')">üë®‚Äçüíª Sobre</button>
            </div>
            
            <div class="input-area">
                <input type="text" id="msg" placeholder="Digite sua pergunta..." onkeypress="if(event.key==='Enter') enviar()">
                <button onclick="enviar()">Enviar</button>
            </div>
            
            <div class="footer">
                <p><strong>NatanAI v4.0 - Sistema H√≠brido</strong></p>
                <p>OpenAI GPT-4o-mini + Base Especializada + Anti-Alucina√ß√£o</p>
                <p style="margin-top: 10px;">üìû WhatsApp: (21) 99282-6074 | üåê natansites.com.br</p>
                <p style="margin-top: 5px;">üì∏ Instagram: @nborges.ofc | üíº natandev02.netlify.app</p>
            </div>
        </div>

        <script>
        function testar(msg) {
            document.getElementById('msg').value = msg;
            enviar();
        }
        
        async function enviar() {
            const input = document.getElementById('msg');
            const chatBox = document.getElementById('chat-box');
            const msg = input.value.trim();
            
            if (!msg) return;
            
            // Mensagem do usu√°rio
            chatBox.innerHTML += `
                <div class="message user">
                    <strong>Voc√™:</strong><br>${msg}
                </div>
            `;
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: msg })
                });
                
                const data = await response.json();
                const metadata = data.metadata || {};
                
                // Determina classe CSS baseada na fonte
                let className = 'message bot';
                if (metadata.fonte && metadata.fonte.includes('openai')) {
                    className += ' bot-hybrid';
                }
                
                // Monta badges de metadata
                let metadataBadges = '';
                if (metadata.fonte) {
                    metadataBadges += `<span class="metadata-badge">üìä ${metadata.fonte}</span>`;
                }
                if (metadata.validacao_anti_alucinacao !== undefined) {
                    const validIcon = metadata.validacao_anti_alucinacao ? '‚úÖ' : '‚ö†Ô∏è';
                    metadataBadges += `<span class="metadata-badge">${validIcon} Valida√ß√£o</span>`;
                }
                if (metadata.confiabilidade) {
                    metadataBadges += `<span class="metadata-badge">üéØ ${metadata.confiabilidade}</span>`;
                }
                
                // Resposta da IA
                const respText = (data.response || data.resposta).replace(/\n/g, '<br>');
                chatBox.innerHTML += `
                    <div class="${className}">
                        <strong>ü§ñ NatanAI:</strong><br>${respText}
                        ${metadataBadges ? `<div class="metadata">${metadataBadges}</div>` : ''}
                    </div>
                `;
                
            } catch (error) {
                chatBox.innerHTML += `
                    <div class="message bot">
                        <strong>ü§ñ NatanAI:</strong><br>
                        Erro de conex√£o. Fale com Natan: (21) 99282-6074<br><br>
                        Vibra√ß√µes Positivas!
                    </div>
                `;
            }
            
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        </script>
    </body>
    </html>
    """
    return render_template_string(html)

# =============================================================================
# INICIALIZA√á√ÉO
# =============================================================================

if __name__ == '__main__':
    print("\n" + "="*80)
    print("ü§ñ NATANAI v4.0 - SISTEMA H√çBRIDO")
    print("="*80)
    print("üë®‚Äçüíª Criador: Natan Borges Alves Nascimento")
    print("üöÄ Web Developer Full-Stack")
    print("üìû WhatsApp: (21) 99282-6074")
    print("üåê Site: natansites.com.br")
    print("üíº Portf√≥lio: natandev02.netlify.app")
    print("="*80)
    
    # Carrega base de conhecimento
    carregar_conhecimento_especializado()
    
    # Verifica OpenAI
    openai_status = verificar_openai()
    
    print(f"\nüîß CONFIGURA√á√ÉO:")
    print(f"   ‚Ä¢ Modelo: {OPENAI_MODEL}")
    print(f"   ‚Ä¢ OpenAI: {'‚úÖ CONECTADO' if openai_status else '‚ö†Ô∏è OFFLINE'}")
    print(f"   ‚Ä¢ Base Especializada: ‚úÖ {len(KNOWLEDGE_BASE)} categorias")
    print(f"   ‚Ä¢ Sistema Anti-Alucina√ß√£o: ‚úÖ ATIVO")
    print(f"   ‚Ä¢ Palavras Proibidas: {len(PALAVRAS_PROIBIDAS)}")
    print(f"   ‚Ä¢ Padr√µes Suspeitos: {len(PADROES_SUSPEITOS)}")
    
    print(f"\nüéØ MODO H√çBRIDO:")
    print(f"   1Ô∏è‚É£ Base Especializada (100% confi√°vel)")
    print(f"   2Ô∏è‚É£ OpenAI GPT-4o-mini (com valida√ß√£o)")
    print(f"   3Ô∏è‚É£ Fallback Inteligente (sempre confi√°vel)")
    
    print(f"\nüõ°Ô∏è PROTE√á√ïES ANTI-ALUCINA√á√ÉO:")
    print(f"   ‚úÖ Valida√ß√£o de informa√ß√µes oficiais")
    print(f"   ‚úÖ Detec√ß√£o de palavras proibidas: {len(PALAVRAS_PROIBIDAS)}")
    print(f"   ‚úÖ Detec√ß√£o de padr√µes suspeitos: {len(PADROES_SUSPEITOS)}")
    print(f"   ‚úÖ Limpeza autom√°tica de alucina√ß√µes")
    print(f"   ‚úÖ Verifica√ß√£o de pre√ßos corretos")
    print(f"   ‚úÖ Verifica√ß√£o de WhatsApp correto")
    print(f"   ‚úÖ Verifica√ß√£o de nome do criador")
    print(f"   ‚úÖ Bloqueio de projetos inventados")
    
    print(f"\nüìä INFORMA√á√ïES DOS SERVI√áOS:")
    print(f"   ‚Ä¢ Planos: Starter (R$ 39,99/m√™s) | Professional (R$ 79,99/m√™s)")
    print(f"   ‚Ä¢ Projetos entregues: {len(INFORMACOES_OFICIAIS['projetos'])}")
    print(f"   ‚Ä¢ Desenvolvimento base: 3-4 horas")
    print(f"   ‚Ä¢ Projeto completo: 1-2 semanas")
    
    print(f"\nüöÄ SERVIDOR INICIANDO...")
    print(f"   ‚Ä¢ Porta: 5000")
    print(f"   ‚Ä¢ Host: 0.0.0.0")
    print(f"   ‚Ä¢ Debug: False")
    print(f"   ‚Ä¢ Threaded: True")
    
    print("\n" + "="*80)
    print("üìû CONTATO: WhatsApp (21) 99282-6074")
    print("üåê SITE: natansites.com.br")
    print("üíº PORTF√ìLIO: natandev02.netlify.app")
    print("="*80 + "\n")
    
    app.run(
        host='0.0.0.0',
        port=5000,
        debug=False,
        threaded=True
    )
